<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Spartans Meeting Logger</title>
  <style>
    :root{
      --sn-red:#DD467D; --sn-black:#111827; --sn-gray:#6b7280; --sn-orange:#ea580c;
      --rec-bg:#f9fafb; --bg:#f8fafc; --card:#ffffff; --line:#e5e7eb;
      --steel-0:#f3f6fb;   /* very light blue-gray */
      --steel-1:#e5ecf5;   /* light steel */
      --steel-2:#cfd9e6;   /* mid steel */
      --steel-3:#aebbd0;   /* deeper steel */
    }
    
    html, body { min-height: 100%; }               /* no fixed height */
    
    body{
      background-color: var(--steel-1);            /* fallback color */
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    /* ensure full-viewport coverage on mobile */
    @supports (height: 100dvh){
      body::before{ height: 100dvh; }
    }
    
    /* Fixed gradient layer so it never clips while scrolling */
    body::before{
      content: "";
      position: fixed;
      inset: 0;
      z-index: -1;                                 /* behind everything */
      pointer-events: none;
      background:
        radial-gradient(1100px 700px at 0% 0%, rgba(99,102,241,.10), transparent 60%),
        radial-gradient(900px 600px at 100% 0%, rgba(14,165,233,.10), transparent 55%),
        linear-gradient(145deg, var(--steel-0) 0%, var(--steel-1) 32%, var(--steel-2) 66%, var(--steel-3) 100%);
    }

    /* iOS zoom prevention + consistent typography for form controls */
    input, select, button, textarea {
      font: inherit;
      font-size: 16px; /* >=16px prevents iOS zoom-on-focus */
    }

    input[type="date"],
    input[type="time"]{
      -webkit-appearance: none;
      appearance: none;
      height: 3rem;              /* = Tailwind h-12 */
      line-height: 3rem;         /* centers the text vertically */
      padding: 0 1rem;           /* same horizontal padding as others */
      font-size: 16px;           /* avoids iOS zoom and huge default font */
      font-variant-numeric: tabular-nums;
    }
  </style>

  <script src="https://cdn.tailwindcss.com"></script>

  <link rel="preload" href="./supernova-wordmark.png" as="image">
</head>
<body>
  <div id="root"></div>

  <!-- React + Babel (CDN) -->
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- App -->
  <script type="text/babel">
    const {useEffect,useMemo,useState} = React;

    const cls = (...xs) => xs.filter(Boolean).join(" ");
    const todayISODate = () => new Date().toISOString().slice(0, 10);
    const nowHM = () => { const d=new Date(); return String(d.getHours()).padStart(2,"0")+":"+String(d.getMinutes()).padStart(2,"0"); };
    const dayName = (iso) => new Date(iso).toLocaleDateString(undefined,{ weekday:"long" });

    const LS = { settings:"sn.meet.settings.v1", history:"sn.meet.history.v1", outbox:"sn.meet.outbox.v1" };

    const DEFAULT_ENDPOINT =
      "https://script.google.com/macros/s/AKfycbyIvFrqE7DwV7TgOx9L3tfDz14F8j9_ePSfhAmpTOB2Mt-LdkLq3h4bFKHQjQUUpZc0UQ/exec";

    // SAME HEIGHT FOR ALL FIELDS (inputs & selects)
    const baseField =
      "w-full h-14 rounded-2xl border border-slate-300 bg-white " +
      "px-3 text-[16px] leading-none shadow-sm outline-none focus:border-slate-400";
    
    // Edit this list anytime
    const UNIT_OPTIONS = [
      "Supernova Direct",
      "Aquila Direct",
      "Stellar Direct",
      "Aurora",
      "Alphara",
      // "… add more"
    ];

    const PRODUCT_OPTIONS = [
      "A+ Signature",
      "ACP 100",
      "AHIP",
      "Ascend",
      "Family Secure",
      "Future Builder",
      "Future Scholar",
      "Goals Protect",
      "Guardian 1",
      "Guardian 65",
      "Health Achieve",
      "Max Protect",
      "Money Tree",
      "Other",
    ];

    const MEETING_PLACES = [
      "Zoom",
      "Cafe/Resto",
      "Client Home",
      "Client Office",
      "AIA Office",
      "Other",
    ];
    
    const defaultSettings = {
      advisorName: "", unit: "" };
    
    const emptyForm = { prospectName:"", date:todayISODate(), time:nowHM(), meetingPlace:"Zoom",
      firstMeeting:true, meetingCount:1, factFinding:false, appSubmitted:false, casePaid:false,
      caseApproved:false, referralsGiven:0, fyp:"", fyc:"", product:"" };

    const readLS = (k,f)=>{ try{ const v=JSON.parse(localStorage.getItem(k)||"null"); return v??f; }catch{return f;} };
    const writeLS = (k,v)=>localStorage.setItem(k,JSON.stringify(v));

    const Page = ({children}) => (
      <div className="min-h-[100dvh] w-full bg-transparent text-slate-900">
        <div className="mx-auto w-full max-w-md px-4 pb-36">{children}</div>
      </div>
    );

    const LOGO_SRC = "./supernova-wordmark.png";
    
    const TopBar = ({ onOpenSettings, pendingCount }) => (
      <header className="sticky top-0 z-50 mb-4 bg-white/90 backdrop-blur border-b border-slate-200 px-4 py-3">
        <div className="flex items-start justify-between">
          <div className="flex flex-col">
            <img
              src={LOGO_SRC}
              alt="Supernova"
              /* move further LEFT to align with the dot */
              className="h-11 sm:h-12 w-auto max-w-[220px] object-contain shrink-0 select-none -ml-4 sm:-ml-3"
              draggable="false"
            />
            <div className="mt-1 flex items-center gap-2">
              <span
                className="inline-block h-2.5 w-2.5 rounded-full"
                style={{ backgroundColor: 'var(--sn-red)' }}
              />
              <h1 className="text-xl font-bold tracking-tight">Spartans Logger</h1>
            </div>
          </div>
    
          <div className="flex items-center gap-3">
            {pendingCount > 0 && (
              <span className="rounded-full bg-amber-100 px-3 py-1 text-xs font-semibold text-amber-800">
                {pendingCount} queued
              </span>
            )}
            <button
              onClick={onOpenSettings}
              className="rounded-2xl border border-slate-200 px-3 py-1.5 text-sm hover:bg-slate-50 active:scale-[0.98]"
            >
              ⚙️ Settings
            </button>
          </div>
        </div>
      </header>
    );

    const Section = ({title,children,right}) => (
      <section className="mb-4 rounded-2xl border border-slate-200 bg-white p-4 shadow-sm">
        <div className="mb-3 flex items-center justify-between">
          <h2 className="text-sm font-semibold tracking-wide text-slate-600 uppercase">{title}</h2>{right}
        </div>{children}
      </section>
    );
    const LabeledInput = ({ label, children }) => (
      <label className="mb-4 block"> {/* was mb-3 */}
        <div className="mb-2 text-[13px] font-medium text-slate-600">{label}</div> {/* was mb-1 */}
        {children}
      </label>
    );
    
    // Text input
    const TextInput = ({ value, onChange, placeholder, type="text", inputMode }) => (
      <input
        value={value}
        onChange={(e)=>onChange(e.target.value)}
        type={type}
        inputMode={inputMode}
        placeholder={placeholder}
        className={baseField}
      />
    );
    
    // Number input
    const NumberInput = ({ value, onChange, step=1, min=0, placeholder }) => (
      <input
        value={value}
        onChange={(e)=>onChange(e.target.value === "" ? "" : Number(e.target.value))}
        type="number"
        step={step}
        min={min}
        inputMode="numeric"
        placeholder={placeholder}
        className={baseField + " appearance-none"}  // consistent on iOS
      />
    );
    
    // Select (dropdown) — same height, custom chevron
    const Select = ({ value, onChange, options, placeholder }) => (
      <div className="relative">
        <select
          value={value}
          onChange={(e)=>onChange(e.target.value)}
          className={baseField + " appearance-none pr-10"}  // opt out of native height; room for chevron
        >
          {/* can't be selected, just a hint in the closed state */}
          <option value="" disabled hidden>{placeholder || "Select…"}</option>
          {options.map(opt => <option key={opt} value={opt}>{opt}</option>)}
        </select>
    
        {/* chevron */}
        <svg
          className="pointer-events-none absolute right-3 top-1/2 -translate-y-1/2 h-5 w-5 text-slate-400"
          viewBox="0 0 20 20" fill="currentColor" aria-hidden="true"
        >
          <path fillRule="evenodd"
            d="M5.23 7.21a.75.75 0 011.06.02L10 10.94l3.71-3.71a.75.75 0 111.06 1.06l-4.24 4.24a.75.75 0 01-1.06 0L5.21 8.27a.75.75 0 01.02-1.06z"
            clipRule="evenodd" />
        </svg>
      </div>
    );

    const ChoiceGrid = ({ options, value, onChange }) => (
      <div className="grid grid-cols-2 gap-3">
        {options.map(opt => (
          <button
            key={opt}
            type="button"
            onClick={() => onChange(opt)}
            className={cls(
              "h-16 rounded-2xl border text-base font-semibold transition active:scale-[0.99]",
              value === opt
                ? "bg-slate-900 text-white border-slate-900"
                : "bg-white text-slate-800 border-slate-300"
            )}
          >
            {opt}
          </button>
        ))}
      </div>
    );

    const FloatingTabBar = ({ tab, setTab }) => (
      <div className="fixed inset-x-0 bottom-0 z-50 pointer-events-none">
        <div className="mx-auto w-full max-w-md px-4 pb-[calc(env(safe-area-inset-bottom)+12px)]">
          {/* ⬇️ red background */}
          <div className="pointer-events-auto rounded-2xl bg-[var(--sn-red)] p-2 grid grid-cols-2 gap-2 shadow-xl ring-1 ring-black/10 backdrop-blur">
            <button
              onClick={() => setTab('log')}
              className={cls(
                "h-12 rounded-xl font-semibold transition",
                tab === "log"
                  ? "bg-slate-900 text-white"
                  : "bg-white text-slate-900"
              )}
              aria-pressed={tab === "log"}
            >
              Log Your Meeting
            </button>
            <button
              onClick={() => setTab('history')}
              className={cls(
                "h-12 rounded-xl font-semibold transition",
                tab === "history"
                  ? "bg-slate-900 text-white"
                  : "bg-white text-slate-900"
              )}
              aria-pressed={tab === "history"}
            >
              History
            </button>
          </div>
        </div>
      </div>
    );
    
    const TileButton = ({ selected, children, onClick }) => (
      <button
        type="button"
        onClick={onClick}
        className={cls(
          // ↓ add leading-snug (or leading-tight if you want it even tighter)
          "h-16 w-full rounded-2xl border shadow-sm px-4 text-base leading-snug text-center active:scale-[0.99] transition",
          selected
            ? "bg-slate-900 text-white border-slate-900"
            : "bg-white text-slate-800 border-slate-300 hover:bg-slate-50"
        )}
      >
        <span className="block leading-snug">{children}</span>
      </button>
    );
    
    const Pills = ({ options, value, onChange }) => (
      <div className="flex flex-wrap gap-2">
        {options.map(opt=>(
          <button key={opt} type="button"
            className={cls(
              "h-12 rounded-full px-4 text-base font-medium border flex items-center",
              value===opt ? "bg-slate-900 text-white border-slate-900"
                          : "bg-slate-100 text-slate-700 border-slate-200 hover:bg-slate-200"
            )}
            onClick={()=>onChange(opt)}>{opt}</button>
        ))}
      </div>
    );
    
    const YesNoCard = ({ label, value, onChange }) => (
      <button
        type="button"
        onClick={() => onChange(!value)}
        className={cls(
          // smaller height/font on tiny screens, larger on bigger ones
          "flex h-14 sm:h-16 w-full items-center justify-between rounded-2xl border text-base sm:text-lg font-semibold shadow-sm px-4 active:scale-[0.99] transition",
          value
            ? "border-emerald-300 bg-emerald-500 text-white"
            : "border-rose-300 bg-rose-500 text-white"
        )}
      >
        <span className="text-left text-[13px] sm:text-sm font-medium opacity-90">
          {label}
        </span>
        <span className="text-lg sm:text-xl tracking-wide">
          {value ? "YES" : "NO"}
        </span>
      </button>
    );
    
    const YesNoGrid = ({ items, form, setForm }) => (
      // force 2 columns by default (works on mobile)
      <div className="grid grid-cols-2 gap-3">
        {items.map((it) => (
          <YesNoCard
            key={it.key}
            label={it.label}
            value={!!form[it.key]}
            onChange={(v) => setForm((f) => ({ ...f, [it.key]: v }))}
          />
        ))}
      </div>
    );

    const TabBar = ({ tab, setTab }) => {
      const Tab = ({ id, label }) => (
        <button onClick={()=>setTab(id)}
          className={cls("flex-1 h-12 rounded-2xl border px-4 text-base font-semibold", tab===id?"bg-slate-900 text-white border-slate-900":"bg-white border-slate-200")}>{label}</button>
      );
      return (<div className="fixed bottom-4 left-0 right-0 mx-auto flex w-full max-w-md gap-3 px-4"><Tab id="log" label="Quick Log"/><Tab id="history" label="History"/></div>);
    };
    const Toast = ({ text, type="ok", onClose }) => {
      useEffect(()=>{ const t=setTimeout(onClose,2600); return ()=>clearTimeout(t); },[onClose]);
      return (
        <div className={cls("fixed left-1/2 top-4 z-[60] -translate-x-1/2 rounded-xl px-4 py-2 text-sm font-medium shadow",
          type==="ok"?"bg-emerald-600 text-white":type==="warn"?"bg-amber-500 text-white":"bg-rose-600 text-white")}>{text}</div>
      );
    };
    const Badge = ({children}) => <span className="rounded-full bg-slate-900 px-2.5 py-1 text-[10px] font-semibold text-white">{children}</span>;

    async function sendToEndpoint(url, record) {
      const endpoint = (url || "").trim();
      if (!endpoint) return false;
      try {
        const res = await fetch(endpoint, {
          method: "POST",
          mode: "no-cors",                       // avoid CORS preflight/restrictions
          headers: { "Content-Type": "text/plain" }, // still sending JSON body
          body: JSON.stringify(record),
        });
        // opaque responses are expected in no-cors; treat as success if it didn't throw
        return res.ok || res.type === "opaque";
      } catch {
        return false;
      }
    }

    function App(){
      const [settings,setSettings]=useState(()=>({...defaultSettings,...readLS(LS.settings,{})}));

      useEffect(() => {
        if (!settings.endpointUrl) {
          setSettings(s => ({ ...s, endpointUrl: DEFAULT_ENDPOINT }));
        }
        // run once on mount
        // eslint-disable-next-line
      }, []);
      
      const [form,setForm]=useState(()=>({...emptyForm}));
      const [tab,setTab]=useState("log");
      const [history,setHistory]=useState(()=>readLS(LS.history,[]));
      const [outbox,setOutbox]=useState(()=>readLS(LS.outbox,[]));
      const [openSettings,setOpenSettings]=useState(false);
      const [toast,setToast]=useState(null);

      const yesNoItems = useMemo(()=>[
        {key:"firstMeeting",label:"1st Meeting?"},
        {key:"factFinding",label:"KYC Done?"},
        {key:"appSubmitted",label:"Submitted?"},
        {key:"casePaid",label:"Paid?"},
        {key:"caseApproved",label:"Approved?"},
      ],[]);

      useEffect(()=>writeLS(LS.settings,settings),[settings]);
      useEffect(()=>writeLS(LS.history,history),[history]);
      useEffect(()=>writeLS(LS.outbox,outbox),[outbox]);

      useEffect(()=>{ setForm(f=>({...f,meetingCount:f.firstMeeting?1:Math.max(2,Number(f.meetingCount)||2)})); },[form.firstMeeting]);

      useEffect(()=>{
        const flush = () => {
          if (outbox.length === 0) return;
          (async () => {
            const remaining = [];
            for (const item of outbox) {
              const ok = await sendToEndpoint(DEFAULT_ENDPOINT, item);
              if (!ok) remaining.push(item);
            }
            if (remaining.length !== outbox.length) {
              setOutbox(remaining);
              if (remaining.length === 0) setToast({ t: "All queued items synced ✅", type: "ok" });
            }
          })();
        };
        flush(); window.addEventListener("focus",flush);
        return ()=>window.removeEventListener("focus",flush);
      },[settings.endpointUrl,outbox]);

      const meetingPlaceOptions=["Zoom","Cafe","Office","Home","Online","Other"];
      const resetForm=()=>setForm({...emptyForm,meetingPlace:form.meetingPlace});
      const payload = useMemo(()=>{
        const dt=`${form.date} ${form.time}`;
        return {
          advisor: settings.advisorName, unit: settings.unit, prospect: form.prospectName,
          date: form.date, day: dayName(form.date), appointmentTime: form.time, meetingPlace: form.meetingPlace,
          firstMeeting: form.firstMeeting?"Yes":"No", noOfMeetings: Number(form.meetingCount)||0,
          factFinding: form.factFinding?"Yes":"No", appSubmitted: form.appSubmitted?"Yes":"No",
          casePaid: form.casePaid?"Yes":"No", referralsGiven: Number(form.referralsGiven)||0,
          fyp: form.fyp === "" ? "" : Number(form.fyp), fyc: form.fyc === "" ? "" : Number(form.fyc),
          product: form.product, caseApproved: form.caseApproved?"Yes":"No",
          timestamp: new Date().toISOString(), dt
        };
      },[form,settings]);

      const [isSending, setIsSending] = useState(false);
      
      const handleSubmit = async () => {
        if (isSending) return;
        if (!settings.advisorName) { setToast({ t:"Set your name in Settings first", type:"warn" }); setOpenSettings(true); return; }
        if (!settings.unit) { setToast({ t:"Select your Unit in Settings", type:"warn" }); setOpenSettings(true); return; }
        if (!form.prospectName)    { setToast({ t:"Prospect name is required", type:"warn" }); return; }
      
        setIsSending(true);
        const record = { id: (crypto.randomUUID?.() || String(Date.now())), ...payload };
        setHistory(h => [record, ...h].slice(0, 200));
      
        const ok = await sendToEndpoint(DEFAULT_ENDPOINT, record);
        if (!ok) { setOutbox(o => [record, ...o]); setToast({ t:"Saved offline — will sync when online", type:"warn" }); }
        else     { setToast({ t:"Submitted ✅", type:"ok" }); }
      
        resetForm();
        setIsSending(false);
      };
      
      const pendingCount = outbox.length;

      return (
        <Page>
          <TopBar onOpenSettings={()=>setOpenSettings(o => !o)} pendingCount={pendingCount}/>
          {openSettings && (
            <Section title="Settings" right={<button onClick={()=>setOpenSettings(false)} className="text-sm font-semibold text-slate-900">Done</button>}>
              <div className="grid gap-3">
                <LabeledInput label="Your Name (Advisor)"><TextInput value={settings.advisorName} onChange={v=>setSettings(s=>({...s,advisorName:v}))} placeholder="e.g., Jimmy Santos"/></LabeledInput>
                <LabeledInput label="Unit *">
                  <Select
                    value={settings.unit}
                    onChange={v=>setSettings(s=>({...s, unit:v}))}
                    options={UNIT_OPTIONS}
                    placeholder="-- Select Unit --"
                  />
                </LabeledInput>
                <div className="flex items-center">
                  <button
                    className="rounded-xl border border-rose-200 bg-rose-50 px-3 py-2 text-sm font-medium text-rose-700 hover:bg-rose-100 focus:outline-none focus-visible:ring-2 focus-visible:ring-rose-300 active:scale-[0.99]"
                    onClick={() => { if(!confirm("Clear all local history & outbox?")) return; localStorage.clear(); location.reload(); }}
                  >
                    Clear Local Data
                  </button>
                </div>
              </div>
            </Section>
          )}

          {/* Log Tab */}
          {tab==="log" && (
            <>
              <Section title="Prospect">
                <LabeledInput label="Prospect Name *"><TextInput value={form.prospectName} onChange={v=>setForm(f=>({...f,prospectName:v}))} placeholder="e.g., Juan Dela Cruz"/></LabeledInput>
                <div className="grid grid-cols-2 gap-3">
                  <LabeledInput label="Date"><TextInput type="date" value={form.date} onChange={v=>setForm(f=>({...f,date:v}))}/></LabeledInput>
                  <LabeledInput label="Time"><TextInput type="time" value={form.time} onChange={v=>setForm(f=>({...f,time:v}))}/></LabeledInput>
                </div>
              </Section>

              <Section title="Meeting Details" right={<span className="text-xs text-slate-500">{dayName(form.date)}</span>}>
                <LabeledInput label="Meeting Place">
                  <ChoiceGrid
                    options={MEETING_PLACES}
                    value={form.meetingPlace}
                    onChange={(v) => setForm(f => ({ ...f, meetingPlace: v }))}
                  />
                </LabeledInput>
                <div className="grid grid-cols-2 gap-3">
                  <LabeledInput label="# of Meetings (so far)"><NumberInput value={form.meetingCount} onChange={v=>setForm(f=>({...f,meetingCount:v}))} min={1}/></LabeledInput>
                  <LabeledInput label="Referrals Given (count)"><NumberInput value={form.referralsGiven} onChange={v=>setForm(f=>({...f,referralsGiven:v}))} min={0}/></LabeledInput>
                </div>
              </Section>

              <Section title="What happened? (tap to toggle)">
                <YesNoGrid items={yesNoItems} form={form} setForm={setForm}/>
              </Section>

              <Section title="Amounts & Product (optional)">
                <div className="grid grid-cols-2 gap-3">
                  <LabeledInput label="FYP (₱)"><NumberInput value={form.fyp} onChange={v=>setForm(f=>({...f,fyp:v}))} min={0} step={100} placeholder="e.g., 12000"/></LabeledInput>
                  <LabeledInput label="FYC (₱)"><NumberInput value={form.fyc} onChange={v=>setForm(f=>({...f,fyc:v}))} min={0} step={100} placeholder="e.g., 2400"/></LabeledInput>
                </div>
                <LabeledInput label="Product">
                  <Select
                    value={form.product}
                    onChange={v=>setForm(f=>({...f, product:v}))}
                    options={PRODUCT_OPTIONS}
                    placeholder="-- Select Product --"
                    // no disablePlaceholder -> remains optional
                  />
              </LabeledInput>
              </Section>

              <div className="mb-36 flex gap-3">
                <button onClick={resetForm} className="flex-1 h-12 rounded-2xl border border-slate-300 bg-white px-4 text-base font-semibold hover:bg-slate-50">Clear</button>
                <button
                  onClick={handleSubmit}
                  disabled={isSending}
                  className={cls("flex-1 h-12 rounded-2xl px-4 text-base font-semibold text-white active:scale-[0.99]", isSending ? "bg-slate-400 cursor-not-allowed" : "bg-slate-900")}
                >
                  {isSending ? "Sending…" : "Submit"}
                </button>
              </div>
            </>
          )}

          {/* History Tab */}
          {tab==="history" && (
            <Section title="Local History">
              <div className="space-y-3">
                {history.length===0 && <div className="text-sm text-slate-500">No entries yet.</div>}
                {history.map(r=>(
                  <div key={r.id} className="rounded-2xl border border-slate-200 bg-white p-3 shadow-sm">

                    {/* Card header */}
                    <div className="flex items-start justify-between gap-3">
                      <div className="flex-1 min-w-0 font-semibold text-lg leading-tight break-words">
                        {r.prospect}
                      </div>
                      <div className="shrink-0 whitespace-nowrap text-xs text-slate-500">
                        {r.date} {r.appointmentTime}
                      </div>
                    </div>
                    
                    {/* meta: place + first/mtgs */}
                    <div className="mt-1 text-xs text-slate-600 flex items-center gap-1">
                      <span>{r.meetingPlace || "—"}</span>
                      <span>•</span>
                      <span className={r.firstMeeting === "Yes" ? "text-emerald-600" : ""}>
                        {r.firstMeeting === "Yes" ? "First meeting" :
                          (Number(r.noOfMeetings) > 0 ? `Mtgs: ${r.noOfMeetings}` : "—")}
                      </span>
                    </div>
                    
                    {/* NEW: referrals on its own line (only when >0) */}
                    {Number(r.referralsGiven) > 0 && (
                      <div className="mt-1 text-xs text-slate-600">
                        Referrals: {Number(r.referralsGiven)}
                      </div>
                    )}
                    
                    {/* divider above activity tags */}
                    <div className="my-3 h-px bg-slate-200"></div>
                    
                    {/* activity tags with equal top/bottom spacing */}
                    <div className="flex flex-wrap gap-2 text-[11px] sm:text-xs">
                      {r.factFinding === "Yes" && <Badge>KYC Done</Badge>}
                      {r.appSubmitted === "Yes" && <Badge>Submitted</Badge>}
                      {r.casePaid === "Yes" && <Badge>Paid</Badge>}
                      {r.caseApproved === "Yes" && <Badge>Approved</Badge>}
                    </div>
                    
                    {/* divider below activity tags */}
                    <div className="my-3 h-px bg-slate-200"></div>
                    
                    {/* Sales stats line 1: FYP + FYC */}
                    <div className="flex flex-wrap items-center gap-x-3 gap-y-1 text-xs text-slate-600">
                      {r.fyp && <span>FYP ₱{Number(r.fyp).toLocaleString()}</span>}
                      {r.fyc && <span>• FYC ₱{Number(r.fyc).toLocaleString()}</span>}
                    </div>
                    
                    {/* Sales stats line 2: Product always on a new line when present */}
                    {r.product && (
                      <div className="mt-1 text-xs text-slate-600">
                        {r.product}
                      </div>
                    )}

                    <div className="mt-3 flex justify-end">
                      <div className="flex gap-2">
                        <button
                          className="rounded-xl border border-slate-300 bg-white px-3 py-2 text-xs hover:bg-slate-50"
                          onClick={async () => {
                            const ok = await sendToEndpoint(DEFAULT_ENDPOINT, r);
                            alert(ok ? "Re-sent ✅" : "Send failed");
                          }}
                        >
                          Re-send
                        </button>
                    
                        <button
                          className="rounded-xl border border-rose-200 bg-rose-50 px-3 py-2 text-xs text-rose-700 hover:bg-rose-100"
                          onClick={() => setHistory(h => h.filter(x => x.id !== r.id))}
                        >
                          Delete
                        </button>
                      </div>
                    </div>
                  </div>
                ))}
              </div>
            </Section>
          )}

          <FloatingTabBar tab={tab} setTab={setTab} />
          {toast && <Toast text={toast.t} type={toast.type||"ok"} onClose={()=>setToast(null)} />}
        </Page>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
  </script>
</body>
</html>
